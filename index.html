<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.553.0.min.js"></script>
    <style>
    .overlay {
      position: absolute; /* Sit on top of the page content */
      display: none; /* Hidden by default */
      width: 100%; /* Full width (cover the whole page) */
      height: 100%; /* Full height (cover the whole page) */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10; /* Specify a stack order in case you're using a different order for other elements */
      cursor: not-allowed; /* Disabled pointer */
      background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4JyBoZWlnaHQ9JzgnPgogIDxyZWN0IHdpZHRoPSc4JyBoZWlnaHQ9JzgnIGZpbGw9JyNmZmYnLz4KICA8cGF0aCBkPSdNMCAwTDggOFpNOCAwTDAgOFonIHN0cm9rZS13aWR0aD0nMC41JyBzdHJva2U9JyNhYWEnLz4KPC9zdmc+Cg=="); 
      background-repeat: repeat; 
      opacity: 0.3;
    }
  </style>
  </head>
  <body>
  <div class="container" style="max-width: 970px;">
    <div class="row mb-4 mt-4">
      <div class="col-md-4 rounded">
        <div class="card">
          <div class="card-header">Object</div>
          <div class="card-body">
            <div class="rounded pt-4 px-4 overlay"></div>
            <div class="custom-file">
              <input id="objectupload" type="file" accept="*" class="custom-file-input">
              <label class="custom-file-label overflow-hidden" for="objectupload">Choose file</label>
            </div>
          </div>
        </div>
        <script>
            $('#objectupload').on('change',function(){
                //get the file name
                var fileName = $(this).val();
                //replace the "Choose a file" label
                $(this).next('.custom-file-label').html(fileName);
            })
        </script>
      </div>
      <div class="col-md-4 rounded">
        <div class="card card-default">
          <div class="card-header">Destination</div>
          <div class="card-body">
            <div class="rounded pt-4 px-4 overlay"></div>
            <div class="form-group">
              <label for="region">Region:</label>
              <input type="text" class="form-control" name="region" id="region">
              <label for="bucket">Bucket:</label>
              <input type="text" class="form-control" name="bucket" id="bucket">
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4 rounded">
        <div class="card card-default">
          <div class="card-header">Credentials</div>
          <div class="card-body">
            <div class="rounded pt-4 px-4 overlay"></div>
            <div class="form-group">
              <label for="keyid">Access Key ID:</label>
              <input type="text" class="form-control" name="keyid" id="keyid">
              <label for="keysecret">Access Key Secret:</label>
              <input type="password" class="form-control" name="keysecret" id="keysecret">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 rounded">
        <div class="card card-default">
          <div id="progress" class="progress mx-2 mt-3">
            <div class="progress-bar progress-bar-success"></div>
          </div>
          <div class="progress-number mx-2 mb-3">&nbsp;</div>
        </div>
      </div>
    </div>
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="form-row mt-1">
          <button id="addobject" onclick="Upload()" class="btn btn-primary ml-2">Upload</button>
          <button id="cancelupload" onclick="Abort()" class="btn btn-danger ml-1" disabled>Abort</button>
        </div>
      </div>
    </div>
  </div>
  </body>
</html>



            

<script>

  var thisUpload = null;

  function getReadableFileSizeString(fileSizeInBytes) {
      var i = -1;
      var byteUnits = [' KB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];
      do {
          fileSizeInBytes = fileSizeInBytes / 1024;
          i++;
      } while (fileSizeInBytes > 1024);

      return Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];
  }

  function fixFilename(username, filename) {
    var cleanfilename = filename.replace(/[^a-zA-Z0-9\.\-\_]+/g,"");
    return username + '/' + cleanfilename
  }

  function validateInputs() {
    var files = document.getElementById("objectupload").files;
    if (!files.length) {
      return "Please choose a file to upload first.";
    }

    var region = document.getElementById("region").value;
    var bucketName = document.getElementById("bucket").value;
    var keyid = document.getElementById("keyid").value;
    var keysecret = document.getElementById("keysecret").value;

    if (keyid === "" || keysecret === "") {
      return "Please enter credentials first.";
    }

    if (region === "" ) {
      return "Please enter a region.";
    }

    if (bucket === "" ) {
      return "Please enter the name of the target bucket for the upload.";
    }

  }

  function lockForm() {
    //document.getElementById("overlay").style.display = 'block';
    document.getElementById("addobject").disabled = true;
    document.getElementById("cancelupload").disabled = false;
    var x = document.getElementsByClassName("overlay");
    var i;
    for (i = 0; i < x.length; i++) {
      x[i].style.display = 'block';
    }
  }

  function unlockForm() {
    //document.getElementById("overlay").style.display = 'none';
    document.getElementById("addobject").disabled = false;
    document.getElementById("cancelupload").disabled = true;
    var x = document.getElementsByClassName("overlay");
    var i;
    for (i = 0; i < x.length; i++) {
      x[i].style.display = 'none';
    }
  }

  function Abort() {
    thisUpload.abort();
    unlockForm();
  }

  function Upload() {


    var msg = validateInputs()
    if (msg) {
      return alert(msg);
    }

    lockForm();

    var file = document.getElementById("objectupload").files[0];
    var keyid = document.getElementById("keyid").value;
    var keysecret = document.getElementById("keysecret").value;
    var bucketName = document.getElementById("bucket").value;
    var region = document.getElementById("region").value;
    var objectKey = file.name;

    AWS.config.region = region;
    AWS.config.httpOptions.timeout = 0; 

    var s3 = new AWS.S3({
      apiVersion: "2006-03-01",
      useAccelerateEndpoint: true,
      clientSideMonitoring: true,
      computeChecksums: true,
      sslEnabled: true,
      accessKeyId: keyid,
      secretAccessKey: keysecret
    });

    $('#progress .progress-bar').css('width',"0px");
    $('#progress .progress-number').html('&nbsp;');
    lockForm();

    // Use S3 ManagedUpload class as it supports multipart uploads
    thisUpload = s3.upload(
    params = {
      Bucket: bucketName,
      Key: objectKey,
      Body: file,
      ACL: "private",
      ServerSideEncryption: 'AES256',
    },
    options = {
      partSize: Math.max(file.size / 1000, 5 * 1024 * 1024),
      queueSize: 4
    });

    thisUpload.on('httpUploadProgress', function(progress) {
      var progress = (progress.loaded * 100) / file.size;
      var progressInt = parseInt(progress)
      lockForm();
      $('#progress .progress-bar').css('width',progressInt + '%');
      $(".progress-number").html(
        getReadableFileSizeString(file.size * progress / 100)+" / "+getReadableFileSizeString(file.size)
        );
    });

    thisUpload.send(function (err, data) {
      if (err){
        unlockForm();
        $(".progress-number").html(
          '<font color="red">'
          + err
          + '</font>');
        console.log(err);
        this.abort()
      }
      else {
        unlockForm();
        $(".progress-number").html(
          'Done. Object has the key: <font color="red">' 
          + bucketName 
          + '/' 
          + objectKey 
          +'</font>'
          )
      }
    });
  }
</script>